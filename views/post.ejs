<!DOCTYPE html>
<html>

<head>
  <title>CORE/<%= community.shortname%>/<%= post.title %> : <%= post.username %></title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="description" content="<%= post.content.substring(0, 160) %>" />
  <meta name="keywords" content="Your, Keywords, Here" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:title" content="<%= post.title %>" />
  <meta property="og:description" content="<%= post.content.substring(0, 160) %>" />
  <meta property="og:image" content="<%= post.user.avatar || '/img/default-avatar.png' %>" />
  <meta property="og:url" content="c-ore.dev/post/<%= post.id %>" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:title" content="<%= post.title %>" />
  <meta property="twitter:description" content="<%= post.content.substring(0, 160) %>" />
  <meta property="twitter:image" content="<%= post.user.avatar || '/img/default-avatar.png' %>" />

  <link rel="stylesheet" href="/css/navbar.css" />
  <link rel="stylesheet" href="/css/post.css" />
  <link rel="shortcut icon" href="/img/core.png" />
  <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
  <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

</head>

<body>

  <%- include('partials/navbar', { pagePath: 'home' }) %>

  <main>
    <div class="main-container">
      <div class="post">
        <div class="header">
          <div class="title">
            <div class="post-title-container">
              <div>
                <h2 class="post-title"><%= post.title %></h2>
              </div>
              <div class="dropdown">
                <button class="dropbtn">
                  <span class="material-symbols-outlined">more_horiz</span>
                </button>
                <div class="dropdown-content" style="display: none;">
                  hellloooo 123
                </div>
              </div>
            </div>

            <p class="post-subtitle">
              <%= post.post_type.charAt(0).toUpperCase() + post.post_type.slice(1) %> in
              <%= post.community.name %>



              <%
              let postDate = new Date(post.created_at);
              let today = new Date();
              let formattedDate;
            
              // Calculate time difference in milliseconds
              let diff = today - postDate;
            
              // Convert time difference to different units
              let minutes = Math.floor(diff / 60000); // 60,000 milliseconds in a minute
              let hours = Math.floor(diff / 3600000); // 3,600,000 milliseconds in an hour
              let days = Math.floor(diff / 86400000); // 86,400,000 milliseconds in a day
              let years = Math.floor(diff / 31536000000); // 31,536,000,000 milliseconds in a year
            
              // Decide the format based on the time difference
              if (minutes < 60) {
                formattedDate = minutes + 'm ago';
              } else if (hours < 24) {
                formattedDate = hours + 'h ago';
              } else if (days < 365) {
                formattedDate = days + 'd ago';
              } else {
                formattedDate = years + 'y ago';
              }
            %>
              <%= formattedDate %>

            </p>

          </div>
        </div>
        <% if (post.post_type == 'project') { %>
        <% 
  let gitHubData;
  try {
    gitHubData = JSON.parse(post.gitHubLinkPreview.raw_json);
  } catch(e) {
    console.error('Error parsing JSON', e);
    gitHubData = {}; // Set a default empty object in case of error
  }
%>
          <div class="sidebar" id="github-link-preview" style=" <% if (post.linkPreview && post.post_type != 'project') { %> max-width: 50%; <% } else { %> width: 100%; <% } %> ">
            <div class=" sidebar-content" onclick="window.location.href='<%= post.linkPreview.url %>'">
              <div class="sidebar-body">
                <div class="sidebar-link-image">

                  <% let imageUrl = post.linkPreview.image || post.linkPreview.favicon; %>
                  <% if (imageUrl) { %>
                  <img src="<%= imageUrl %>" alt="Preview" class="preview-image" />
                  <% } %>
                </div>
                <div class="sidebar-description">
                  <div class="sidebar-link-info">
                    <div class="sidebar-link-info-url">
                      <div class="github-repo-title">
  <% if (post.gitHubMatchUsername) { %>

                        <% } %>
                        <h4>GitHub: <%= gitHubData.name %></h4>
                        <span class="material-symbols-outlined" style=" font-weight: 500; color: green; font-size: 17px;">
  done
                        </span>
                      </div>
                      <div class="github-repo-description">
                        <p>
                        <%= gitHubData.description %>
                        </p>
                      </div>
                    </div>
                    <div class="github-repo-info">
                      <div class="tags">
                        <span class=tag-flair>
                          <span class="material-symbols-outlined">
                            code
                          </span>
                          <a href="#" class="tag"><%= gitHubData.language %></a>
                        </span>

                        <span class=tag-flair>
                          <span class="material-symbols-outlined">
                            bug_report
                          </span>
                          <a href="#" class="tag"><%= gitHubData.open_issues %></a>
                        </span>
                        <span class=tag-flair>
                          <span class="material-symbols-outlined">
                            star
                          </span>

                          <a href="#" class="tag"><%= gitHubData.stargazers_count %></a>
                        </span>

                        <span class=tag-flair>
                          <a href="#" class="tag"> <%= new Date(gitHubData.pushed_at).toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: '2-digit' }) %></a>
                        </span>

                      </div>
                    </div>

                  </div>

                </div>
              </div>
            </div>
          </div>

        <% } %>

        <div class="post-container">
          <div class="post-content" style="
          <% if (post.post_type == 'blog') { %>
          background-color: rgba(0, 0, 0, 0.00);
          border: 0;
          padding: 0;
          <% } %>
          ">
            <% if (post.post_type != 'blog') { %>
            <div class="post-interactions-header">
              <div class="post-user-info-header">
                <img class="avatar" src="<%= post.user.avatar || '/img/default-avatar.png' %>" alt="Avatar" onerror="standby()" />
                <a href="/profile/<%= post.user.username %>" class="post-user-info">
                  <div class="post-user-info">
                    <%= post.user.username %>
                  </div>
                </a>
              </div>
              <div class="dropdown">
                <button class="dropbtn">
                  <span class="material-symbols-outlined">more_horiz</span>
                </button>
                <div class="dropdown-content" style="display: none;">
                  hellloooo 123
                </div>
              </div>
            </div>
            <% } %>
            <div class="post-body" style="
            <% if (post.post_type == 'blog') { %>
            padding: 0;
            <% } %>">
<% if ((post.post_type == 'discussion' && !post.linkPreview) || post.post_type == 'project') { %>
              <%- post.content %>
            <% } else { %>

             <% } %>
              <div class="user-interactions">
                <button id="reactionButton" class="reaction-button">üòÄ</button>
                <div id="reactionPopup" class="reaction-popup" style="display:none;">
                  <button class="reaction-choice">‚ö°Ô∏è</button>
                  <button class="reaction-choice">‚ù§Ô∏è</button>
                  <button class="reaction-choice">üëç</button>
                  <button class="reaction-choice">ü§î</button>
                  <button class="reaction-choice">üí°</button>
                  <button class="reaction-choice">üéâ</button>
                </div>
                <% const reactionTypes = [
        {
            type: "boost",
            icon: "‚ö°Ô∏è",
            count: post.boostCount
        },
        {
            type: "LOVE",
            icon: "‚ù§Ô∏è",
            count: post.loveCount
        },
        {
            type: "LIKE",
            icon: "üëç",
            count: post.likeCount
        },
        {
            type: "CURIOUS",
            icon: "ü§î",
            count: post.curiousCount
        },
        {
            type: "INTERESTING",
            icon: "üí°",
            count: post.interestingCount
        },
        {
            type: "CELEBRATE",
            icon: "üéâ",
            count: post.celebrateCount
        }
    ]; %>
                <% let reactionsCount = 0; %>
                <% reactionTypes.forEach(reaction => { %>
                <% if (reaction.count > 0) { %>
                <% reactionsCount += reaction.count; %>
                <button class="reaction-button" onclick='
                <% if (user) { %>
                    interactWithPost(<%= post.id %>, "<%= user.username %>", "<%= reaction.type %>")
                <% } else { %>
                    window.location.href = "/login";
                <% } %>
            '><%= reaction.icon %> <%= reaction.count %></button>
                <% } %>
                <% }); %>
                <% if (user && user.username === post.username) { %>

                <form action="/post/<%= post.id %>?_method=DELETE" method="POST" style="display: flex;">
                  <input type="hidden" name="_method" value="DELETE" />
                  <button class="reaction-button" onclick="return confirmDeletion(this);">
                    <p style="margin-top: -19px;margin-bottom: -18px;">üóëÔ∏è</p>
                  </button>
                </form>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="comments-section">
        <div class="post-info">
          <div class="post-counts">
            <%= post.comments.length ? post.comments.length : 0 %> comments
            ‚Ä¢
            <%= reactionsCount ? reactionsCount: 0 %> reaction<%= reactionsCount > 1 ? 's' : '' %>
          </div>
          <div class="sort-selector">
            <button class="sort-option active" onclick="sortComments('best')">Best</button>
            <button class="sort-option" onclick="sortComments('newest')">Newest</button>
          </div>
        </div>
        <div class="tags-div">
          <% if (post.tags && post.tags.length > 0) { %>
          <div class="tags">
            <% post.tags.forEach(tag => { %>
            <span class="tag-flair">
              <a href="#" class="tag"><%= tag.name %></a>
            </span>
            <% }); %>
          </div>
          <% } %>
          <% 
  let gitHubData;
  try {
    gitHubData = JSON.parse(post.gitHubLinkPreview.raw_json);
  } catch(e) {
    console.error('Error parsing JSON', e);
    gitHubData = {}; // Set a default empty object in case of error
  }
%>
          <% if (gitHubData.topics && gitHubData.topics.length > 0) {%>
          <div class="tags">
            <% gitHubData.topics.forEach(topic => { %>
            <span class="tag-flair">
              <a href="#" class="tag"><%= topic %></a>
            </span>
            <% }); %>
          </div>
          <% } %>


        </div>
        <% function renderComments(comments, level = 0) { %>


        <% comments.forEach(comment =>
        { %>
        <% if (level == 0) { %>
        <div class="comment-with-replies">
          <% } %>
          <div class="comment">

            <div class="comment-main">

              <div class="comment-content">
                <div class="comment-header">
                  <div class="repliers-avatar">
                    <% if (level == 0) { %>
                    <img src="<%= comment.user.avatar || '/img/default-avatar.png' %>" alt="Avatar" class="avatar" onerror="standby()" />
                    <% } else { %>
                    <img src="<%= comment.user.avatar || '/img/default-avatar.png' %>" alt="Avatar" class="avatar-nested" onerror="standby()" />
                    <% } %>
                  </div>
                  <a class="comment-user-info" href="/profile/<%= comment.user.username %>">
                    <div class="repliers-info">
                      <%= comment.user.username%>
                    </div>
                  </a>

                  <p>to</p>
                  <a class="comment-user-info" href="/profile/<%= comment.parent_author.username %>">
                    <%= comment.parent_author.username %>
                  </a>
                  <span>&#183;</span>

                  <% let commentDate = new Date(comment.created_at);
            let currentDate = new Date();
            let timeDifference = currentDate - commentDate;
            let minutes = Math.floor(timeDifference / 60000);
            let hours = Math.floor(minutes / 60);
            let days = Math.floor(hours / 24);
            let timeSinceComment = '';

            if (days > 0) {
              timeSinceComment = days + 'd ago';
            } else if (hours > 0) {
              timeSinceComment = hours +  'h ago';
            } else if (minutes > 0) {
              timeSinceComment = minutes + 'm ago';
            } else {
              timeSinceComment = 'Just now';
            }
            %>
                  <span class="comment-timestamp"><%= timeSinceComment %></p>

                </div>

                <div class="dropdown-<%= comment.id %>">
                  <button class="dropbtn" onclick="showDropdown(event)">
                    <span class="material-symbols-outlined">more_horiz</span>
                  </button>
                  <div class="dropdown-content" style="display: none;">


                    <% if (user && user.username === comment.user.username) { %>

                    <form id="delete-comment-form-<%= comment.id %>" class="reactionButton" action="/comment/<%= comment.id %>?_method=DELETE" method="POST" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                      <input type="hidden" name="_method" value="DELETE" />
                      <button type="submit" class="delete-comment-button-<%= comment.id %>">
                        Delete
                      </button>
                    </form> <% } %>
                  </div>
                </div>
              </div>
              <div class="comment-body">
                <p>
                  <%- linkify(comment.comment) %>
                </p>
              </div>


              <% if (user) { %>
              <form action="/comments/<%= comment.id %>/replies" method="POST" class="reply-form" style="display: none">
                <textarea name="comment" required></textarea>
                <button type="submit">Submit Reply</button>
              </form>
              <% } %>


              <div class="user-actions">

                <% if (level == 0) {%>
                <div class="comment-user-interactions">
                  <button id="reactionButton" class="reaction-button">üòÄ</button>
                  <div id="reactionPopup" class="reaction-popup" style="display:none;">
                    <button class="reaction-choice">‚ö°Ô∏è</button>
                    <button class="reaction-choice">‚ù§Ô∏è</button>
                    <button class="reaction-choice">üëç</button>
                    <button class="reaction-choice">ü§î</button>
                    <button class="reaction-choice">üí°</button>
                    <button class="reaction-choice">üéâ</button>
                  </div>
                  <% const reactionTypes = [
        {
            type: "boost",
            icon: "‚ö°Ô∏è",
            count: comment.boostCount
        },
        {
            type: "LOVE",
            icon: "‚ù§Ô∏è",
            count: comment.loveCount
        },
        {
            type: "LIKE",
            icon: "üëç",
            count: comment.likeCount
        },
        {
            type: "CURIOUS",
            icon: "ü§î",
            count: comment.curiousCount
        },
        {
            type: "INTERESTING",
            icon: "üí°",
            count: comment.interestingCount
        },
        {
            type: "CELEBRATE",
            icon: "üéâ",
            count: comment.celebrateCount
        }
    ]; %>
                  <% reactionTypes.forEach(reaction => { %>
                  <% if (reaction.count > 0) { %>
                  <button class="reaction-button" onclick='
                <% if (user) { %>
                    interactWithPost(<%= post.id %>, "<%= user.username %>", "<%= reaction.type %>")
                <% } else { %>
                    window.location.href = "/login";
                <% } %>
            '><%= reaction.icon %> <%= reaction.count %></button>
                  <% } %>
                  <% }); %>
                  <% if (level == 0) { %>
                  <div class="replies">
                    <a href="#" id="reply-button" onclick="showReplyForm('<%= comment.id %>', event)">
                      <% 
function countAllReplies(replies) {
    if (!replies || replies.length === 0) return 0;
    let total = 0;
    for (const reply of replies) {
        total += 1 + countAllReplies(reply.replies);
    }
    return total;
}
const totalReplies = countAllReplies(comment.replies);
%>
                      <button class="reaction-button">üí¨ <%= totalReplies%>
                      </button>
                    </a>
                  </div>
                  <% } %>
                </div>

                <% } %>

                <% if (level >= 3) {%>
                <div class="comment-chevron" onclick="toggleNestedComments(' <%= comment.id %>', <%= nestedLevel %>)">
                  <% 
function countAllReplies(replies) {
    if (!replies || replies.length === 0) return 0;
    let total = 0;
    for (const reply of replies) {
        total += 1 + countAllReplies(reply.replies);
    }
    return total;
}
const totalReplies = countAllReplies(comment.replies);
%>

                  <% if (totalReplies > 0) { %>
                  <span class="material-symbols-outlined chevron">chevron_right</span>
                  <% if (level >= 3) { %>
                  <span class="replies-count" onclick="toggleNestedComments('<%= comment.id %>', <%= nestedLevel %>)">
                    <%= totalReplies %> <% if (totalReplies === 1) { %> reply <% } else { %> replies <% } %>
                  </span>
                  <% } %> <% } %>
                </div>
                <% } %>
              </div>
            </div>


            <% if (comment.replies && comment.replies.length > 0) { %>
            <% var nestedLevel = level + 1; %>
            <% var divClass = 'nested-comment level-' + Math.min(nestedLevel, 6); %>
            <div class="<%= divClass %>" id="nested-comments-<%= comment.id %>" style="
      <% if (nestedLevel < 4) { %>
      display: block;
      <% } else { %>
      display: none;
      <% } %>
      ">

              <% renderComments(comment.replies, nestedLevel); %>
            </div>
            <% } %>
          </div>


          <% if (level == 0) { %>

          <div class="reply-form">
            <form id="reply-form-<%= comment.id %>" action="/comments/<%= comment.id %>/replies" method="POST" style="display: block">
              <div class="input-container">
                <textarea id="comment-<%= comment.id %>" name="comment" rows="1" required onclick="autoExpandTextarea(event); showReplyButtons('<%= comment.id %>')" maxlength="500" placeholder="Reply to <%= comment.user.username %>..."></textarea>
                <div class="reply-buttons" id="reply-buttons-<%= comment.id %>" style="display: none;">
                  <button id="cancel-button" type="button" class="fab" onclick="cancelReply('<%= comment.id %>')">Cancel</button>

                  <button id="submit-button" type="submit" class="fab">Submit</button>
                </div>
              </div>
            </form>
          </div>


        </div>
        <% } %>

        <% }) %>
        <% } %>
        <% renderComments(post.comments); %>

      </div>
    </div>
    <div class="sidebar-container" style="<% if (post.linkPreview && post.post_type != 'project') { %>flex-direction: row; <% } else { %> flex-direction: column; gap: 0px; <% } %>">

      <div class="sidebar" style=" <% if (post.linkPreview && post.post_type != 'project') { %> max-width: 50%; <% } else { %> width: 100%; <% } %> ">
        <div class=" sidebar-content">
          <div class="sidebar-body">
            <div class="sidebar-poster-avatar">
              <img src="<%= post.user.avatar || '/img/default-avatar.png' %>" alt="Avatar" class="sidebar-avatar" onerror="standby()" />
            </div>
            <div class="sidebar-poster">
              <div class="sidebar-poster-info">
                <div class="sidebar-poster-name">
                  <a href="/profile/<%= post.user.username %>" style="text-decoration: none;">
                    <%= post.user.username %>
                  </a>
                  <%= post.user.points ? `(${post.user.points} points)` : '0'%> points

                </div>
                <div class="sidebar-poster-job">
                  <% if (post.user.currentJob && post.user.currentCompany) { %>
                  <%= post.user.currentJob %>@<strong><%= post.user.currentCompany %></strong>
                  <% } else { %>
                  No job information
                  <% } %>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% if (post.linkPreview && (post.post_type != 'project' && post.post_type != 'discussion') ) { %>
      <div class="sidebar">
        <div class="sidebar-content">

          <div class="sidebar-body">
            <div class="sidebar-link-image">


              <a href="<%= post.linkPreview.url %>">
                <% let imageUrl = post.linkPreview.image || post.linkPreview.favicon; %>
                <% if (imageUrl) { %>
                <img src="<%= imageUrl %>" alt="Preview" class="preview-image" />
                <% } %>
            </div>
            <div class="sidebar-link-info-title">
              <%= post.linkPreview.title %>
            </div>
            <div class="sidebar-link-info">
              <div class="sidebar-link-info-url">
                <%= post.linkPreview.url %>
              </div>
            </div>
          </div>
        </div>
        <% } %>

  </main>


  <script>
    function showDropdown(event) {
      event.stopPropagation(); // Stop the click from propagating to the document

      // Find the dropdown content next to the clicked button
      var dropdownContent = event.currentTarget.nextElementSibling;

      // Check if the current dropdown is already open
      var isCurrentlyShown = dropdownContent.style.display === 'block';

      // Close all dropdowns first
      closeAllDropdowns();

      // If the dropdown was not already open, open it
      if (!isCurrentlyShown) {
        dropdownContent.style.display = 'block';
      }
    }

    function closeAllDropdowns() {
      const allDropdowns = document.querySelectorAll('.dropdown-content');
      allDropdowns.forEach(function(dropdown) {
        dropdown.style.display = 'none';
      });
    }

    // Attach an event listener to the document to close all dropdowns when clicking anywhere else
    document.addEventListener('click', closeAllDropdowns);

    // This function is to prevent the click inside the dropdown from propagating to the document
    document.addEventListener('click', function(event) {
      const withinBoundaries = event.composedPath().includes(event.target.closest('.dropdown-content'));

      if (withinBoundaries) {
        event.stopPropagation(); // Prevent the click from closing the dropdown immediately
      }
    }, true); // True here sets the listener to the capture phase
    function showReplyButtons(commentId) {
      // Show the reply buttons
      var replyButtons = document.getElementById('reply-buttons-' + commentId);
      replyButtons.style.display = 'flex';
    }

    function cancelReply(commentId) {
      // Clear the textarea
      var textarea = document.getElementById('comment-' + commentId);
      textarea.value = '';
      textarea.rows = 1;

      // Hide the reply buttons
      var replyButtons = document.getElementById('reply-buttons-' + commentId);
      replyButtons.style.display = 'none';
    }

    function autoExpandTextarea(event) {
      event.target.style.height = 'inherit';
      event.target.style.height = `${event.target.scrollHeight}px`;
    }
    // JavaScript function to toggle nested comments
    function toggleNestedComments(commentId, level) {
      var nestedComments = document.getElementById('nested-comments-' + commentId);
      if (nestedComments) {
        var isDisplayed = nestedComments.style.display === 'block';
        nestedComments.style.display = isDisplayed ? 'none' : 'block'; // Toggle display

        // Change chevron direction based on visibility
        var chevron = nestedComments.previousElementSibling.querySelector('.chevron');
        if (chevron) {
          chevron.textContent = isDisplayed ? 'chevron_right' : 'expand_more';
        }

        // Optionally, if you want to hide all deeper nested comments when collapsing one,
        // you can add the following lines:
        if (isDisplayed) {
          var allNested = nestedComments.querySelectorAll('.nested-comment');
          allNested.forEach(function(nested) {
            nested.style.display = 'none'; // Hide all deeper nested comments
            // Reset all chevrons in deeper nested comments
            var innerChevrons = nested.previousElementSibling.querySelectorAll('.chevron');
            innerChevrons.forEach(function(chevron) {
              chevron.textContent = 'chevron_right';
            });
          });
        }
      }
    }



    function submitForm(formId, event) {
      event.preventDefault();
      var form = document.getElementById(formId);

      if (!form) {
        console.error("Form not found: " + formId);
        return false;
      }

      var isReplyForm = formId.startsWith("reply-form");

      var inputField;
      if (isReplyForm) {
        inputField = form.querySelector("textarea");
      } else {
        inputField = form.querySelector('input[name="comment"]');
      }

      // Check if the input field or textarea exists
      if (!inputField) {
        console.error("Input field not found in form: " + formId);
        return false;
      }

      // Validate input value
      if (inputField.value.trim() === "") {
        alert("Your message cannot be empty.");
        return false;
      } else {
        // Submit the form
        form.submit();
      }
    }

    function interactWithPost(postId, user, action) {
      if (!user) {
        window.location.href = '/login';
        return;
      }

      fetch(`/posts/${postId}/react`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            user: user,
            action: action
          }) // Ensure action is in lowercase
        })
        .then(response => response.json())
        .then(data => {


          // Update or create reaction buttons
          reactionTypes.forEach(reaction => {
            const reactionCount = data.reactions[reaction.type] || 0;
            let reactionButton = document.querySelector(`.reaction-button.${reaction.type.toLowerCase()}-button`);

            if (!reactionButton && reactionCount > 0) {
              // Create a new reaction button if it doesn't exist and the count is positive
              reactionButton = document.createElement("button");
              reactionButton.className = `reaction-button ${reaction.type.toLowerCase()}-button`;
              reactionButton.onclick = () => interactWithPost(postId, user, reaction.type);

              const icon = document.createElement("span");
              icon.innerText = reaction.icon;

              const countText = document.createElement("span");
              countText.className = "reaction-count";
              countText.innerText = ` ${reactionCount}`;

              reactionButton.appendChild(icon);
              reactionButton.appendChild(countText);
              reactionInteractionsDiv.appendChild(reactionButton);
            } else if (reactionButton) {
              // Update count of existing button
              const countSpan = reactionButton.getElementsByClassName('reaction-count')[0];
              countSpan.innerText = ` ${reactionCount}`;

              // Update button color if needed
              if (reaction.type.toLowerCase() === action.toLowerCase()) {
                reactionButton.style.color = "blue"; // Change color to indicate selected action
              } else {
                reactionButton.style.color = "black"; // Reset color for other buttons
              }
            }
          });
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

    function showReplyForm(commentId, event) {
      event.preventDefault();
      var form = document.getElementById("reply-form-" + commentId);
      form.style.display = form.style.display === "none" ? "block" : "none";
    }

    function confirmDeletion(element) {
      if (confirm('Are you sure you want to delete this post?')) {
        element.closest('form').submit();
      }
      return false;
    }

    function standby() {
      document.getElementById('avatar').src = "/img/default-avatar.png"
    }

    function autoExpandTextarea(event) {
      event.target.style.height = 'inherit';
      event.target.style.height = `${event.target.scrollHeight}px`;
    }
    document.addEventListener("DOMContentLoaded", function() {
      const posts = document.querySelectorAll('.post-container');

      posts.forEach(post => {
        const content = post.querySelector('.post-content');
        const viewMore = post.querySelector('.view-more');

        if (content.scrollHeight > content.clientHeight) {
          // Content is longer than the max height
          viewMore.style.display = 'block';

          viewMore.addEventListener('click', function() {
            if (content.style.maxHeight) {
              // If max-height is set, remove it
              content.style.maxHeight = null;
              viewMore.textContent = 'View More';
            } else {
              // Set max-height to scrollHeight to expand
              content.style.maxHeight = content.scrollHeight + 'px';
              viewMore.textContent = 'View Less';
            }
          });
        }
      });
    });

    document.addEventListener("DOMContentLoaded", function() {
      var postContents = document.querySelectorAll('.post-content');

      postContents.forEach(function(postContent) {
        if (postContent.scrollHeight > postContent.clientHeight) {
          postContent.classList.add('overflow');
        }
      });
    });

    document.getElementById('reactionButton').addEventListener('click', function() {
      var popup = document.getElementById('reactionPopup');
      popup.style.display = popup.style.display === 'none' ? 'block' : 'none'; // Toggle display
    });

    // Close the popup if a reaction is selected
    var choices = document.querySelectorAll('.reaction-choice');
    choices.forEach(function(choice) {
      choice.addEventListener('click', function() {
        document.getElementById('reactionPopup').style.display = 'none';

      });
    });



    document.getElementById('comment').addEventListener('input', autoExpandTextarea);
  </script>
</body>

</html>